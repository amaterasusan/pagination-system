class t extends class extends class{constructor(){this.events={}}subscribe(t,e){this.events[t]=e}unsubscribe(t){if(this.events[t]){const{[t]:e,...i}=this.events;this.events=i}}fire(t,...e){const i=this.events[t];if(i)return i(...e)}}{constructor(t){if(super(),!(t.container instanceof HTMLElement))throw new Error("Paging Container is not HTMLElement");if(!t.countRecords)throw new Error("countRecords is not set!");this.container=t.container,this.perPage=t.perPage||10,this.countRecords=t.countRecords||0,this.isShowPerPage=t.isShowPerPage??!0,this.numPage=1,this.activeBtns=[];this.loading=["auto","more","none"].includes(t.loading)?t.loading:"none",this.statusBoxSelector=".dg-status-box",this.pagingBoxSelector=".dg-paging",this.perPageSelector="#per-page",this.paginatorSelector=".pagination",this.showMoreSelector=".show-more",this.template=function(){function t(t,i=10,s=!0){const n=e(1,t);let a=[`<select id="per-page" class="dg-per-page${s?"":" per-page-hide"}">`];return[5,10,15,20,30,40,50].forEach((t=>{const e=t===i?" selected":"";a=[...a,`<option value="${t}"${e}>${t}</option>`]})),a=[...a,"</select>"].join(""),`<div class="dg-status-box"><div class="dg-paging">${a}<div class="pagination">${n}</div></div>`}function e(t=1,e,s=!1){let n=`<div id="number-pages" class="dg-number-pages">${i(t,e).join("")}</div>`;if(e>1){n=`${`<button type="button" ${s?"":"disabled"} data-index="first">&laquo;</button>`}${`<button type="button" ${s?"":"disabled"} data-index="prev">&lsaquo;</button>`}${n}${`<button type="button" ${t===e?"disabled":""} data-index="next">&rsaquo;</button>`}${`<button type="button" ${t===e?"disabled":""} data-index="last">&raquo;</button>`}`}return n}function i(t,e){const i=2,r=2*i;let o=[];return o=e<10?[...o,...s(1,e+1)]:t<r+1?[...o,...s(1,r+4),...a(e)]:t>e-r?[...o,...n(1),...s(e-r-2,e+1)]:[...o,...n(1),...s(t-i,t+i+1),...a(e)],o}function s(t,e){let i=[];for(let s=t;s<e;s++)i.push(`<button type="button" tabindex="${s}" data-index="${s}">${s}</button>`);return i}function n(t){let e=[];return e.push(`<button type="button" tabindex="${t}" data-index="${t}">${t}</button>`),e.push('<button type="button" data-index="disabled" disabled>...</button>'),e}function a(t){let e=[];return e.push('<button type="button" data-index="disabled" disabled>...</button>'),e.push(`<button type = "button" tabindex = "${t}" data-index="${t}" >${t}</button >`),e}function r(){return'<div class="show-more"><i class="fa fa-repeat fa-4x fa-fw" aria-hidden="true"></i> <span>more</span></div>'}return{htmlTemplate:t,htmlBtns:e,showMoreTemplate:r}}()}initPaging(){this.setNumberPages(),this.displayTemplatePages(),this.visiblePagingBox()}setNumberPages(){this.numberPages=Math.ceil(this.countRecords/this.perPage)}displayTemplatePages(){this.container.querySelector(this.statusBoxSelector)&&this.container.querySelector(this.statusBoxSelector).remove(),this.container.insertAdjacentHTML("beforeend",this.template.htmlTemplate(this.numberPages,this.perPage,this.isShowPerPage)),this.pagingBox=this.container.querySelector(this.pagingBoxSelector),this.perPageElement=this.container.querySelector(this.perPageSelector),this.paginatorElement=this.container.querySelector(this.paginatorSelector)}render(){this.numberPages>1?(this.displayBtns(),this.visiblePaging(!0)):(this.paginatorElement.innerHTML="",this.visiblePaging(!1)),this.setActivePageBtn()}displayBtns(){this.paginatorElement.innerHTML=this.template.htmlBtns(this.numPage,this.numberPages,!(1===this.numPage||this.activeBtns.length&&1===this.activeBtns[0]))}visiblePagingBox(){this.numberPages>1&&(this.visiblePaging(!0),this.setActivePageBtn())}visiblePaging(t){this.pagingBox.style.visibility=t||this.numberPages>1?"visible":"hidden"}setActivePageBtn(){if(this.numberPages>1){const t=this.container.querySelector(`[data-index="${this.numPage}"]`);t&&t.classList.add("active","current"),this.activeBtns.length&&this.activeBtns.forEach((t=>{const e=this.paginatorElement.querySelector(`[data-index="${t}"]`);e&&e.classList.add("active")}))}}clearActiveBtns(){this.activeBtns=[]}}{constructor(t){super(t)}init(){this.renderPages().then((t=>{this.initPaging(),this.setLoadingDependencies(),this.setEvent(),"auto"===this.loading&&this.observe(t)}))}setLoadingDependencies(){this.showMoreElement&&this.visibileShowMoreBtn(!1),"auto"===this.loading?this.setInfiniteObserver():"more"===this.loading&&(this.showMoreElement||this.setShowMoreBtn(),this.visibileShowMoreBtn(!0))}setInfiniteObserver(){this.infiniteObserver=new IntersectionObserver((([t],e)=>{t.isIntersecting&&(e.unobserve(t.target),this.handlerShowMore())}),{threshold:.8})}setEvent(){this.setPerPageEvent(),this.setPaginationEvent(),this.setShowMoreEvent()}setPerPageEvent(){this.perPageElement&&this.perPageElement.addEventListener("change",this.handlerPerPage.bind(this),!1)}setPaginationEvent(){this.paginatorElement&&this.paginatorElement.addEventListener("click",this.handlerGoPage.bind(this),!1)}setShowMoreEvent(){this.showMoreElement&&"true"!==this.showMoreElement.getAttribute("listener")&&(this.showMoreElement.setAttribute("listener","true"),this.showMoreElement.addEventListener("click",this.handlerShowMore.bind(this),!1))}handlerPerPage(t){const e=t.target;e.blur(),this.perPage=+e.value,this.eventName="perPage",this.numPage=1,this.clearActiveBtns(),this.setNumberPages(),this.renderPages().then((()=>{this.afterRenderData()}))}handlerGoPage(t){this.eventName="goPage";const e=t.target.dataset.index;if(!e)return!1;switch(e){case"prev":this.activeBtns.length&&this.activeBtns[0]>1?this.numPage=this.activeBtns[0]-1:this.numPage--;break;case"next":this.numPage++;break;case"first":this.numPage=1;break;case"last":this.numPage=this.numberPages;break;default:this.numPage=+e}this.clearActiveBtns(),this.renderData(!1)}handlerShowMore(t){this.eventName=t?"showMore":"moreAuto",this.numPage!==this.numberPages&&(this.clearActiveBtns(),this.numPage<this.numberPages&&(this.paginatorElement.querySelectorAll("button.active").forEach((t=>{this.activeBtns.push(+t.dataset.index)})),this.numPage++,this.renderData(!0)))}renderPages(){return this.fire("renderPages",this.perPage,this.numPage)}renderData(t){this.fire("renderData",this.numPage,t).then((t=>{"auto"===this.loading&&this.observe(t),this.afterRenderData()}))}afterRenderData(){this.checkScroll(),this.render()}checkScroll(){["goPage","perPage"].includes(this.eventName)&&(this.fire("goToTop",this.perPage,this.numPage),this.eventName="none")}observe(t){t instanceof HTMLElement?(this.lastChild=t,this.observeLastChild()):console.error("autoload is not possible, last child of collection is not HTMLElement!")}observeLastChild(){this.infiniteObserver&&this.lastChild&&this.infiniteObserver.observe(this.lastChild)}setShowMoreBtn(){this.showMoreElement||(this.displayShowMoreBtn(),this.visibileShowMoreBtn(!1))}displayShowMoreBtn(){this.pagingBox.insertAdjacentHTML("afterend",this.template.showMoreTemplate()),this.showMoreElement=this.container.querySelector(this.showMoreSelector)}visibileShowMoreBtn(t){this.showMoreElement.style.display=t?"flex":"none"}}class e{constructor(t){if(!(t.container instanceof HTMLElement))throw new Error("Data container is not HTMLElement!");if("function"!=typeof t.dataRenderFn)throw new Error("dataRenderFn is not a Function!");this.container=t.container,this.dataRenderFn=t.dataRenderFn,this.childSelector=t.childSelector||null}renderPages(){throw new Error("renderPages method should be implemented in the child class")}renderData(){throw new Error("renderData method should be implemented in the child class")}getLastChild(){return this.container.querySelector(`${this.childSelector}:last-child`)}goToTop(){this.container.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}}class i extends e{constructor({data:t,...e}){if(super(e),!Array.isArray(t))throw new Error("data is not an array!");this.data=t,this.pages=[],this.lastChild=null}renderPages(t,e){return this.pages=this.dataPagination(t),this.renderData(e)}renderData(t,e=!1){const i=this.pages[t-1];return this.container.innerHTML=e?this.container.innerHTML+this.dataRenderFn(i):this.dataRenderFn(i),this.childSelector&&(this.lastChild=this.getLastChild()),Promise.resolve(this.lastChild)}dataPagination(t){let e=[];for(let i=0,s=this.data.length,n=+t;i<s;i+=n){let t=this.data.slice(i,i+n);e=[...e,t]}return e}}class s extends e{constructor({url:t,urlParams:e,...i}){if(super(i),!t)throw new Error("url must be defined");if(!e)throw new Error("urlParams must be defined");if(!e.pageNumber)throw new Error("urlParams.pageNumber must be defined");this.url=t,this.urlParams=e,this.dimmerElement=i.dimmerSelector&&document.querySelector(i.dimmerSelector),this.lastChild=null}renderPages(t,e){return this.limitData=t,this.renderData(e)}renderData(t,e=!1){return this.toggleDimmer(!0),this.loadServerData(t).then((t=>(this.displayData(t,e),this.toggleDimmer(!1),this.childSelector&&(this.lastChild=this.getLastChild()),this.lastChild))).catch((t=>{throw this.toggleDimmer(!1),new Error(t)}))}loadServerData(t=1){const e=this.urlParams.limit?`${this.url}?${this.urlParams.limit}=${this.limitData}&${this.urlParams.pageNumber}=${t}`:`${this.url}?${this.urlParams.pageNumber}=${t}`;return fetch(e).then((t=>t.json()))}displayData(t,e=!1){this.container.innerHTML=e?this.container.innerHTML+this.dataRenderFn(t):this.dataRenderFn(t)}toggleDimmer(t){this.dimmerElement&&(t?(this.dimmerElement.classList.add("active"),this.container.style.opacity=.7):(this.dimmerElement.classList.remove("active"),this.container.style.opacity=1))}}class n extends class{constructor(t){let e={perPage:10,countRecords:0,isShowPerPage:!0,loading:"none",...t||{}};const{dataOptions:i,pagingOptions:s}=(({pagingContainer:t,perPage:e,countRecords:i,isShowPerPage:s,loading:n,dataContainer:a,...r})=>({pagingOptions:{container:t,perPage:e,countRecords:i,isShowPerPage:s,loading:n},dataOptions:{container:a,...r}}))(e);i.urlParams&&!i.urlParams.limit&&(s.isShowPerPage=!1),this.dataOptions=i,this.pagingOptions=s}init(){this.checkMethods(),this.pagingControl.subscribe("renderPages",this.renderPages.bind(this)),this.pagingControl.subscribe("renderData",this.renderData.bind(this)),this.pagingControl.subscribe("goToTop",this.goToTop.bind(this)),this.pagingControl.init()}checkMethods(){const t=["renderPages","renderData"];for(const e of t)if("function"!=typeof this.dataControl[e])throw new Error(`${e} method should be implemented! in Data class`)}renderPages(t,e){return this.dataControl.renderPages(t,e)}renderData(t,e){return this.dataControl.renderData(t,e)}goToTop(){"function"==typeof this.dataControl.goToTop&&this.dataControl.goToTop()}}{constructor(e){super(e),this.dataControl=function(t){return t.data?new i(t):t.url?new s(t):void 0}(this.dataOptions),this.pagingControl=new t(this.pagingOptions),this.init()}}export{n as default};
