!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PaginationSystem=t()}(this,(function(){"use strict";class e extends class extends class{constructor(){this.events={}}subscribe(e,t){this.events[e]=t}unsubscribe(e){if(this.events[e]){const{[e]:t,...i}=this.events;this.events=i}}fire(e,...t){const i=this.events[e];if(i)return i(...t)}}{constructor(e){if(super(),!(e.container instanceof HTMLElement))throw new Error("Paging Container is not HTMLElement");if(!e.countRecords)throw new Error("countRecords is not set!");this.container=e.container,this.perPage=e.perPage||10,this.countRecords=e.countRecords||0,this.isShowPerPage=e.isShowPerPage??!0,this.numPage=1,this.activeBtns=[];this.loading=["auto","more","none"].includes(e.loading)?e.loading:"none",this.statusBoxSelector=".dg-status-box",this.pagingBoxSelector=".dg-paging",this.perPageSelector="#per-page",this.paginatorSelector=".pagination",this.showMoreSelector=".show-more",this.template=function(){function e(e,i=10,s=!0){const n=t(1,e);let a=[`<select id="per-page" class="dg-per-page${s?"":" per-page-hide"}">`];return[5,10,15,20,30,40,50].forEach((e=>{const t=e===i?" selected":"";a=[...a,`<option value="${e}"${t}>${e}</option>`]})),a=[...a,"</select>"].join(""),`<div class="dg-status-box"><div class="dg-paging">${a}<div class="pagination">${n}</div></div>`}function t(e=1,t,s=!1){let n=`<div id="number-pages" class="dg-number-pages">${i(e,t).join("")}</div>`;if(t>1){n=`${`<button type="button" ${s?"":"disabled"} data-index="first">&laquo;</button>`}${`<button type="button" ${s?"":"disabled"} data-index="prev">&lsaquo;</button>`}${n}${`<button type="button" ${e===t?"disabled":""} data-index="next">&rsaquo;</button>`}${`<button type="button" ${e===t?"disabled":""} data-index="last">&raquo;</button>`}`}return n}function i(e,t){const i=2,r=2*i;let o=[];return o=t<10?[...o,...s(1,t+1)]:e<r+1?[...o,...s(1,r+4),...a(t)]:e>t-r?[...o,...n(1),...s(t-r-2,t+1)]:[...o,...n(1),...s(e-i,e+i+1),...a(t)],o}function s(e,t){let i=[];for(let s=e;s<t;s++)i.push(`<button type="button" tabindex="${s}" data-index="${s}">${s}</button>`);return i}function n(e){let t=[];return t.push(`<button type="button" tabindex="${e}" data-index="${e}">${e}</button>`),t.push('<button type="button" data-index="disabled" disabled>...</button>'),t}function a(e){let t=[];return t.push('<button type="button" data-index="disabled" disabled>...</button>'),t.push(`<button type = "button" tabindex = "${e}" data-index="${e}" >${e}</button >`),t}function r(){return'<div class="show-more"><i class="fa fa-repeat fa-4x fa-fw" aria-hidden="true"></i> <span>more</span></div>'}return{htmlTemplate:e,htmlBtns:t,showMoreTemplate:r}}()}initPaging(){this.setNumberPages(),this.displayTemplatePages(),this.visiblePagingBox()}setNumberPages(){this.numberPages=Math.ceil(this.countRecords/this.perPage)}displayTemplatePages(){this.container.querySelector(this.statusBoxSelector)&&this.container.querySelector(this.statusBoxSelector).remove(),this.container.insertAdjacentHTML("beforeend",this.template.htmlTemplate(this.numberPages,this.perPage,this.isShowPerPage)),this.pagingBox=this.container.querySelector(this.pagingBoxSelector),this.perPageElement=this.container.querySelector(this.perPageSelector),this.paginatorElement=this.container.querySelector(this.paginatorSelector)}render(){this.numberPages>1?(this.displayBtns(),this.visiblePaging(!0)):(this.paginatorElement.innerHTML="",this.visiblePaging(!1)),this.setActivePageBtn()}displayBtns(){this.paginatorElement.innerHTML=this.template.htmlBtns(this.numPage,this.numberPages,!(1===this.numPage||this.activeBtns.length&&1===this.activeBtns[0]))}visiblePagingBox(){this.numberPages>1&&(this.visiblePaging(!0),this.setActivePageBtn())}visiblePaging(e){this.pagingBox.style.visibility=e||this.numberPages>1?"visible":"hidden"}setActivePageBtn(){if(this.numberPages>1){const e=this.container.querySelector(`[data-index="${this.numPage}"]`);e&&e.classList.add("active","current"),this.activeBtns.length&&this.activeBtns.forEach((e=>{const t=this.paginatorElement.querySelector(`[data-index="${e}"]`);t&&t.classList.add("active")}))}}clearActiveBtns(){this.activeBtns=[]}}{constructor(e){super(e)}init(){this.renderPages().then((e=>{this.initPaging(),this.setLoadingDependencies(),this.setEvent(),"auto"===this.loading&&this.observe(e)}))}setLoadingDependencies(){this.showMoreElement&&this.visibileShowMoreBtn(!1),"auto"===this.loading?this.setInfiniteObserver():"more"===this.loading&&(this.showMoreElement||this.setShowMoreBtn(),this.visibileShowMoreBtn(!0))}setInfiniteObserver(){this.infiniteObserver=new IntersectionObserver((([e],t)=>{e.isIntersecting&&(t.unobserve(e.target),this.handlerShowMore())}),{threshold:.8})}setEvent(){this.setPerPageEvent(),this.setPaginationEvent(),this.setShowMoreEvent()}setPerPageEvent(){this.perPageElement&&this.perPageElement.addEventListener("change",this.handlerPerPage.bind(this),!1)}setPaginationEvent(){this.paginatorElement&&this.paginatorElement.addEventListener("click",this.handlerGoPage.bind(this),!1)}setShowMoreEvent(){this.showMoreElement&&"true"!==this.showMoreElement.getAttribute("listener")&&(this.showMoreElement.setAttribute("listener","true"),this.showMoreElement.addEventListener("click",this.handlerShowMore.bind(this),!1))}handlerPerPage(e){const t=e.target;t.blur(),this.perPage=+t.value,this.eventName="perPage",this.numPage=1,this.clearActiveBtns(),this.setNumberPages(),this.renderPages().then((()=>{this.afterRenderData()}))}handlerGoPage(e){this.eventName="goPage";const t=e.target.dataset.index;if(!t)return!1;switch(t){case"prev":this.activeBtns.length&&this.activeBtns[0]>1?this.numPage=this.activeBtns[0]-1:this.numPage--;break;case"next":this.numPage++;break;case"first":this.numPage=1;break;case"last":this.numPage=this.numberPages;break;default:this.numPage=+t}this.clearActiveBtns(),this.renderData(!1)}handlerShowMore(e){this.eventName=e?"showMore":"moreAuto",this.numPage!==this.numberPages&&(this.clearActiveBtns(),this.numPage<this.numberPages&&(this.paginatorElement.querySelectorAll("button.active").forEach((e=>{this.activeBtns.push(+e.dataset.index)})),this.numPage++,this.renderData(!0)))}renderPages(){return this.fire("renderPages",this.perPage,this.numPage)}renderData(e){this.fire("renderData",this.numPage,e).then((e=>{"auto"===this.loading&&this.observe(e),this.afterRenderData()}))}afterRenderData(){this.checkScroll(),this.render()}checkScroll(){["goPage","perPage"].includes(this.eventName)&&(this.fire("goToTop",this.perPage,this.numPage),this.eventName="none")}observe(e){e instanceof HTMLElement?(this.lastChild=e,this.observeLastChild()):console.error("autoload is not possible, last child of collection is not HTMLElement!")}observeLastChild(){this.infiniteObserver&&this.lastChild&&this.infiniteObserver.observe(this.lastChild)}setShowMoreBtn(){this.showMoreElement||(this.displayShowMoreBtn(),this.visibileShowMoreBtn(!1))}displayShowMoreBtn(){this.pagingBox.insertAdjacentHTML("afterend",this.template.showMoreTemplate()),this.showMoreElement=this.container.querySelector(this.showMoreSelector)}visibileShowMoreBtn(e){this.showMoreElement.style.display=e?"flex":"none"}}class t{constructor(e){if(!(e.container instanceof HTMLElement))throw new Error("Data container is not HTMLElement!");if("function"!=typeof e.dataRenderFn)throw new Error("dataRenderFn is not a Function!");this.container=e.container,this.dataRenderFn=e.dataRenderFn,this.childSelector=e.childSelector||null}renderPages(){throw new Error("renderPages method should be implemented in the child class")}renderData(){throw new Error("renderData method should be implemented in the child class")}getLastChild(){return this.container.querySelector(`${this.childSelector}:last-child`)}goToTop(){this.container.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}}class i extends t{constructor({data:e,...t}){if(super(t),!Array.isArray(e))throw new Error("data is not an array!");this.data=e,this.pages=[],this.lastChild=null}renderPages(e,t){return this.pages=this.dataPagination(e),this.renderData(t)}renderData(e,t=!1){const i=this.pages[e-1];return this.container.innerHTML=t?this.container.innerHTML+this.dataRenderFn(i):this.dataRenderFn(i),this.childSelector&&(this.lastChild=this.getLastChild()),Promise.resolve(this.lastChild)}dataPagination(e){let t=[];for(let i=0,s=this.data.length,n=+e;i<s;i+=n){let e=this.data.slice(i,i+n);t=[...t,e]}return t}}class s extends t{constructor({url:e,urlParams:t,...i}){if(super(i),!e)throw new Error("url must be defined");if(!t)throw new Error("urlParams must be defined");if(!t.pageNumber)throw new Error("urlParams.pageNumber must be defined");this.url=e,this.urlParams=t,this.dimmerElement=i.dimmerSelector&&document.querySelector(i.dimmerSelector),this.lastChild=null}renderPages(e,t){return this.limitData=e,this.renderData(t)}renderData(e,t=!1){return this.toggleDimmer(!0),this.loadServerData(e).then((e=>(this.displayData(e,t),this.toggleDimmer(!1),this.childSelector&&(this.lastChild=this.getLastChild()),this.lastChild))).catch((e=>{throw this.toggleDimmer(!1),new Error(e)}))}loadServerData(e=1){const t=this.urlParams.limit?`${this.url}?${this.urlParams.limit}=${this.limitData}&${this.urlParams.pageNumber}=${e}`:`${this.url}?${this.urlParams.pageNumber}=${e}`;return fetch(t).then((e=>e.json()))}displayData(e,t=!1){this.container.innerHTML=t?this.container.innerHTML+this.dataRenderFn(e):this.dataRenderFn(e)}toggleDimmer(e){this.dimmerElement&&(e?(this.dimmerElement.classList.add("active"),this.container.style.opacity=.7):(this.dimmerElement.classList.remove("active"),this.container.style.opacity=1))}}return class extends class{constructor(e){let t={perPage:10,countRecords:0,isShowPerPage:!0,loading:"none",...e||{}};const{dataOptions:i,pagingOptions:s}=(({pagingContainer:e,perPage:t,countRecords:i,isShowPerPage:s,loading:n,dataContainer:a,...r})=>({pagingOptions:{container:e,perPage:t,countRecords:i,isShowPerPage:s,loading:n},dataOptions:{container:a,...r}}))(t);i.urlParams&&!i.urlParams.limit&&(s.isShowPerPage=!1),this.dataOptions=i,this.pagingOptions=s}init(){this.checkMethods(),this.pagingControl.subscribe("renderPages",this.renderPages.bind(this)),this.pagingControl.subscribe("renderData",this.renderData.bind(this)),this.pagingControl.subscribe("goToTop",this.goToTop.bind(this)),this.pagingControl.init()}checkMethods(){const e=["renderPages","renderData"];for(const t of e)if("function"!=typeof this.dataControl[t])throw new Error(`${t} method should be implemented! in Data class`)}renderPages(e,t){return this.dataControl.renderPages(e,t)}renderData(e,t){return this.dataControl.renderData(e,t)}goToTop(){"function"==typeof this.dataControl.goToTop&&this.dataControl.goToTop()}}{constructor(t){super(t),this.dataControl=function(e){return e.data?new i(e):e.url?new s(e):void 0}(this.dataOptions),this.pagingControl=new e(this.pagingOptions),this.init()}}}));
